<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Billun Atelier - Transport Dubois</title>
    <style>
      /* Variables couleurs coh√©rentes avec l'√©cosyst√®me Billun */
      :root {
          --blue-primary: #2563eb;
          --blue-dark: #1d4ed8;
          --blue-light: #3b82f6;
          --blue-bg: #eff6ff;
          --gray-50: #f8fafc;
          --gray-100: #f1f5f9;
          --gray-200: #e2e8f0;
          --gray-600: #475569;
          --gray-800: #1e293b;
          --white: #ffffff;
          --green: #10b981;
          --yellow: #f59e0b;
          --orange: #f97316;
          --red: #ef4444;
          --purple: #8b5cf6;
      }

      // Gestion des sp√©cialit√©s selon la fonction
      function updateSpecialtiesOptions(functionSelect) {
          const specialtyCheckboxes = document.querySelectorAll('input[name="specialties"]');
          const certificationCheckboxes = document.querySelectorAll('input[name="certifications"]');
          const selectedFunction = functionSelect.value;

          // R√©initialiser toutes les cases
          specialtyCheckboxes.forEach(cb => cb.checked = false);
          certificationCheckboxes.forEach(cb => cb.checked = false);

          // Pr√©-cocher selon la fonction
          const functionPresets = {
              'chef_atelier': {
                  specialties: ['mecanique_generale', 'hydraulique', 'diagnostic'],
                  certifications: ['adr', 'controle_technique']
              },
              'mecanicien_senior': {
                  specialties: ['mecanique_generale', 'diagnostic'],
                  certifications: ['controle_technique']
              },
              'mecanicien': {
                  specialties: ['mecanique_generale'],
                  certifications: []
              },
              'electricien': {
                  specialties: ['electricite', 'diagnostic'],
                  certifications: ['habilitation_electrique', 'chronotachygraphe']
              },
              'frigoriste': {
                  specialties: ['froid'],
                  certifications: ['fluides_frigo']
              },
              'carrossier': {
                  specialties: ['carrosserie', 'soudure'],
                  certifications: ['soudure_certifiee']
              },
              'pneumaticien': {
                  specialties: ['pneumatique'],
                  certifications: []
              }
          };

          const preset = functionPresets[selectedFunction];
          if (preset) {
              preset.specialties.forEach(specialty => {
                  const checkbox = document.querySelector(`input[name="specialties"][value="${specialty}"]`);
                  if (checkbox) checkbox.checked = true;
              });

              preset.certifications.forEach(cert => {
                  const checkbox = document.querySelector(`input[name="certifications"][value="${cert}"]`);
                  if (checkbox) checkbox.checked = true;
              });
          }
      }

      /* Reset et styles de base */
      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
      }

      body {
          font-family: system-ui, -apple-system, sans-serif;
          color: var(--gray-800);
          background-color: var(--gray-50);
          line-height: 1.6;
      }

      /* Layout principal */
      .workshop-container {
          display: flex;
          min-height: 100vh;
      }

      /* Sidebar navigation */
      .sidebar {
          width: 280px;
          background: var(--white);
          border-right: 1px solid var(--gray-200);
          box-shadow: 2px 0 8px rgba(0, 0, 0, 0.05);
      }

      .sidebar-header {
          padding: 20px;
          background: linear-gradient(135deg, var(--blue-bg) 0%, #e0f2fe 100%);
          border-bottom: 1px solid var(--gray-200);
      }

      .workshop-logo {
          display: flex;
          align-items: center;
          gap: 12px;
          margin-bottom: 12px;
      }

      .logo-icon {
          width: 40px;
          height: 40px;
          background: var(--orange);
          border-radius: 8px;
          display: flex;
          align-items: center;
          justify-content: center;
          color: var(--white);
          font-weight: bold;
          font-size: 18px;
      }

      .workshop-info {
          flex: 1;
      }

      .workshop-name {
          font-size: 1.1rem;
          font-weight: 700;
          color: var(--orange);
      }

      .brand-text {
          font-size: 0.8rem;
          color: var(--gray-600);
      }

      .user-info {
          font-size: 0.85rem;
          color: var(--gray-600);
          margin-top: 8px;
      }

      /* Navigation menu */
      .nav-menu {
          padding: 20px 0;
      }

      .nav-link {
          display: flex;
          align-items: center;
          gap: 12px;
          padding: 14px 20px;
          color: var(--gray-600);
          text-decoration: none;
          transition: all 0.2s ease;
          border-left: 3px solid transparent;
          font-size: 0.9rem;
      }

      .nav-link:hover {
          background: var(--blue-bg);
          color: var(--blue-primary);
          border-left-color: var(--blue-light);
      }

      .nav-link.active {
          background: var(--blue-bg);
          color: var(--blue-primary);
          border-left-color: var(--blue-primary);
          font-weight: 600;
      }

      .nav-icon {
          width: 20px;
          height: 20px;
          font-size: 18px;
          display: flex;
          align-items: center;
          justify-content: center;
      }

      /* Zone de contenu principal */
      .main-content {
          flex: 1;
          display: flex;
          flex-direction: column;
      }

      .content-header {
          background: var(--white);
          padding: 20px 30px;
          border-bottom: 1px solid var(--gray-200);
          display: flex;
          justify-content: space-between;
          align-items: center;
      }

      .page-title {
          font-size: 1.5rem;
          font-weight: 600;
          color: var(--gray-800);
      }

      .header-actions {
          display: flex;
          gap: 12px;
          align-items: center;
      }

      .content-body {
          flex: 1;
          padding: 30px;
          overflow-y: auto;
      }

      /* Cartes de contenu */
      .card {
          background: var(--white);
          border-radius: 12px;
          padding: 24px;
          margin-bottom: 24px;
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
          border: 1px solid var(--gray-200);
      }

      .card-title {
          font-size: 1.2rem;
          font-weight: 600;
          color: var(--gray-800);
          margin-bottom: 20px;
          padding-bottom: 12px;
          border-bottom: 1px solid var(--gray-200);
          display: flex;
          justify-content: space-between;
          align-items: center;
      }

      /* Boutons */
      .btn {
          padding: 10px 16px;
          border: none;
          border-radius: 6px;
          font-size: 0.875rem;
          font-weight: 500;
          cursor: pointer;
          transition: all 0.2s ease;
          text-decoration: none;
          display: inline-flex;
          align-items: center;
          gap: 6px;
      }

      .btn-primary {
          background: var(--blue-primary);
          color: var(--white);
      }

      .btn-secondary {
          background: var(--gray-200);
          color: var(--gray-600);
      }

      .btn-success {
          background: var(--green);
          color: var(--white);
      }

      .btn-warning {
          background: var(--orange);
          color: var(--white);
      }

      .btn-danger {
          background: var(--red);
          color: var(--white);
      }

      .btn-small {
          padding: 6px 12px;
          font-size: 0.8rem;
      }

      /* Tables */
      .data-table {
          width: 100%;
          border-collapse: collapse;
          margin-top: 16px;
      }

      .data-table th,
      .data-table td {
          padding: 12px;
          text-align: left;
          border-bottom: 1px solid var(--gray-200);
          vertical-align: top;
      }

      .data-table th {
          background: var(--gray-100);
          font-weight: 600;
          color: var(--gray-800);
          font-size: 0.875rem;
      }

      .data-table tr:hover {
          background: var(--gray-50);
      }

      /* Badges de statut */
      .badge {
          padding: 4px 10px;
          border-radius: 12px;
          font-size: 0.75rem;
          font-weight: 500;
          text-transform: uppercase;
          display: inline-block;
      }

      .badge-green { background: var(--green); color: var(--white); }
      .badge-yellow { background: var(--yellow); color: var(--gray-800); }
      .badge-orange { background: var(--orange); color: var(--white); }
      .badge-red { background: var(--red); color: var(--white); }
      .badge-blue { background: var(--blue-primary); color: var(--white); }
      .badge-purple { background: var(--purple); color: var(--white); }

      /* Statistiques dashboard */
      .stats-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 20px;
          margin-bottom: 24px;
      }

      .stat-card {
          background: var(--white);
          padding: 20px;
          border-radius: 12px;
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
          border-left: 4px solid var(--blue-primary);
      }

      .stat-card.urgent { border-left-color: var(--red); }
      .stat-card.warning { border-left-color: var(--orange); }
      .stat-card.success { border-left-color: var(--green); }

      .stat-number {
          font-size: 1.8rem;
          font-weight: 700;
          color: var(--blue-primary);
          margin-bottom: 4px;
      }

      .stat-number.urgent { color: var(--red); }
      .stat-number.warning { color: var(--orange); }
      .stat-number.success { color: var(--green); }

      .stat-label {
          color: var(--gray-600);
          font-size: 0.875rem;
      }

      /* Formulaires */
      .form-grid {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 16px;
          margin-top: 16px;
      }

      .form-group {
          display: flex;
          flex-direction: column;
          gap: 6px;
      }

      .form-group.full-width {
          grid-column: 1 / -1;
      }

      .form-label {
          font-weight: 500;
          color: var(--gray-600);
          font-size: 0.875rem;
      }

      .form-input, .form-select, .form-textarea {
          padding: 10px 12px;
          border: 1px solid var(--gray-200);
          border-radius: 6px;
          font-size: 0.875rem;
          transition: border-color 0.2s ease;
      }

      .form-input:focus, .form-select:focus, .form-textarea:focus {
          outline: none;
          border-color: var(--blue-primary);
          box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.1);
      }

      .form-textarea {
          min-height: 80px;
          resize: vertical;
          font-family: inherit;
      }

      /* Messages de notification */
      .notification {
          padding: 12px 16px;
          border-radius: 6px;
          margin-bottom: 16px;
          display: none;
      }

      .notification.success {
          background: rgba(16, 185, 129, 0.1);
          color: var(--green);
          border: 1px solid var(--green);
      }

      .notification.warning {
          background: rgba(245, 158, 11, 0.1);
          color: var(--orange);
          border: 1px solid var(--orange);
      }

      .notification.show {
          display: block;
      }

      /* Sections de contenu */
      .content-section {
          display: none;
      }

      .content-section.active {
          display: block;
      }

      /* Toggle de disponibilit√© */
      .availability-toggle {
          display: flex;
          align-items: center;
          gap: 8px;
          margin: 8px 0;
      }

      .toggle {
          position: relative;
          width: 44px;
          height: 24px;
          background: var(--gray-200);
          border-radius: 12px;
          cursor: pointer;
          transition: background-color 0.3s ease;
      }

      .toggle.active {
          background: var(--green);
      }

      .toggle::before {
          content: '';
          position: absolute;
          top: 2px;
          left: 2px;
          width: 20px;
          height: 20px;
          background: white;
          border-radius: 50%;
          transition: transform 0.3s ease;
      }

      .toggle.active::before {
          transform: translateX(20px);
      }

      .toggle-label {
          font-size: 0.8rem;
          color: var(--gray-600);
      }

      /* Planning visuel */
      .planning-calendar {
          background: var(--gray-50);
          border-radius: 12px;
          padding: 20px;
          margin-top: 16px;
      }

      .calendar-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 20px;
          padding-bottom: 12px;
          border-bottom: 2px solid var(--gray-200);
      }

      .calendar-month {
          font-size: 1.2rem;
          font-weight: 600;
          color: var(--gray-800);
      }

      .calendar-nav {
          display: flex;
          gap: 8px;
      }

      .calendar-grid {
          display: grid;
          grid-template-columns: repeat(7, 1fr);
          gap: 8px;
      }

      .calendar-day-header {
          text-align: center;
          font-weight: 600;
          color: var(--gray-600);
          padding: 8px;
          font-size: 0.8rem;
      }

      .calendar-day {
          aspect-ratio: 1;
          border: 1px solid var(--gray-200);
          border-radius: 8px;
          background: var(--white);
          display: flex;
          flex-direction: column;
          padding: 4px;
          position: relative;
          cursor: pointer;
          transition: all 0.2s ease;
      }

      .calendar-day:hover {
          border-color: var(--blue-primary);
          transform: scale(1.02);
      }

      .calendar-day.today {
          border-color: var(--blue-primary);
          background: var(--blue-bg);
      }

      .calendar-day-number {
          font-size: 0.8rem;
          font-weight: 600;
          color: var(--gray-800);
      }

      .calendar-event {
          font-size: 0.6rem;
          padding: 1px 3px;
          border-radius: 3px;
          margin: 1px 0;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
      }

      .event-maintenance {
          background: var(--orange);
          color: white;
      }

      .event-control {
          background: var(--red);
          color: white;
      }

      .event-chrono {
          background: var(--purple);
          color: white;
      }

      /* Galerie photos */
      .photo-gallery-modal {
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.9);
          z-index: 2000;
      }

      .photo-gallery-modal.show {
          display: flex;
          align-items: center;
          justify-content: center;
      }

      .photo-gallery-content {
          background: var(--white);
          border-radius: 12px;
          padding: 30px;
          max-width: 90vw;
          max-height: 90vh;
          width: 800px;
          overflow-y: auto;
      }

      .photo-gallery-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 20px;
          padding-bottom: 12px;
          border-bottom: 1px solid var(--gray-200);
      }

      .photo-gallery-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 16px;
          margin-top: 20px;
      }

      .photo-item {
          background: var(--gray-50);
          border-radius: 8px;
          overflow: hidden;
          border: 1px solid var(--gray-200);
          transition: transform 0.2s ease;
      }

      .photo-item:hover {
          transform: scale(1.02);
      }

      .photo-item img {
          width: 100%;
          height: 150px;
          object-fit: cover;
          cursor: pointer;
      }

      .photo-info {
          padding: 12px;
      }

      .photo-title {
          font-weight: 600;
          color: var(--gray-800);
          margin-bottom: 4px;
          font-size: 0.875rem;
      }

      .photo-meta {
          font-size: 0.75rem;
          color: var(--gray-600);
      }

      .photo-status {
          margin-top: 8px;
      }

      /* Lightbox pour voir les photos en grand */
      .lightbox {
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.95);
          z-index: 3000;
          justify-content: center;
          align-items: center;
      }

      .lightbox.show {
          display: flex;
      }

      .lightbox img {
          max-width: 90%;
          max-height: 90%;
          object-fit: contain;
      }

      .lightbox-close {
          position: absolute;
          top: 20px;
          right: 30px;
          color: white;
          font-size: 2rem;
          cursor: pointer;
          background: none;
          border: none;
      }

      /* Modal */
      .modal {
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.5);
          z-index: 1000;
      }

      .modal.show {
          display: flex;
          align-items: center;
          justify-content: center;
      }

      .modal-content {
          background: var(--white);
          border-radius: 12px;
          padding: 30px;
          max-width: 600px;
          width: 90%;
          max-height: 80vh;
          overflow-y: auto;
      }

      .modal-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 20px;
          padding-bottom: 12px;
          border-bottom: 1px solid var(--gray-200);
      }

      .modal-title {
          font-size: 1.3rem;
          font-weight: 600;
          color: var(--gray-800);
      }

      .modal-close {
          background: none;
          border: none;
          font-size: 1.5rem;
          cursor: pointer;
          color: var(--gray-600);
      }

      /* Responsive */
      @media (max-width: 768px) {
          .sidebar {
              width: 240px;
          }

          .content-header {
              padding: 15px 20px;
              flex-direction: column;
              gap: 12px;
              align-items: stretch;
          }

          .content-body {
              padding: 20px;
          }

          .form-grid {
              grid-template-columns: 1fr;
          }

          .stats-grid {
              grid-template-columns: 1fr 1fr;
          }

          .calendar-grid {
              grid-template-columns: repeat(7, 1fr);
              gap: 4px;
          }

          .calendar-day {
              aspect-ratio: 0.8;
          }
      }

      @media (max-width: 640px) {
          .workshop-container {
              flex-direction: column;
          }

          .sidebar {
              width: 100%;
              height: auto;
          }

          .data-table {
              font-size: 0.8rem;
          }

          .stats-grid {
              grid-template-columns: 1fr;
          }
      }
    </style>
  </head>
  <body>
    <div class="workshop-container">
      <!-- Sidebar Navigation -->
      <div class="sidebar">
        <div class="sidebar-header">
          <div class="workshop-logo">
            <div class="logo-icon">üîß</div>
            <div class="workshop-info">
              <div class="workshop-name">Atelier Dubois</div>
              <div class="brand-text">Billun Workshop</div>
            </div>
          </div>
          <div class="user-info">
            Connect√© en tant que <strong>Sophie M√©canicien</strong><br />
            Chef d'atelier
          </div>
        </div>

        <nav class="nav-menu">
          <a href="#" class="nav-link active" data-section="monitoring">
            <span class="nav-icon">üì∏</span>
            Signalements & Anomalies
          </a>
          <a href="#" class="nav-link" data-section="vehicles">
            <span class="nav-icon">üöõ</span>
            Suivi du mat√©riel
          </a>
          <a href="#" class="nav-link" data-section="add-vehicle">
            <span class="nav-icon">‚ûï</span>
            Ajouter mat√©riel
          </a>
          <a href="#" class="nav-link" data-section="personnel">
            <span class="nav-icon">üë•</span>
            Personnel d'atelier
          </a>
          <a href="#" class="nav-link" data-section="mobile">
            <span class="nav-icon">üì±</span>
            Application mobile
          </a>
        </nav>
      </div>

      <!-- Contenu Principal -->
      <main class="main-content">
        <header class="content-header">
          <h1 class="page-title">Signalements & Anomalies</h1>
          <div class="header-actions">
            <button class="btn btn-primary" onclick="showNewReportModal()">
              + Nouveau signalement
            </button>
            <button class="btn btn-danger" onclick="handleLogout()">
              D√©connexion
            </button>
          </div>
        </header>

        <div class="content-body">
          <!-- Section Signalements & Anomalies -->
          <div id="monitoring-section" class="content-section active">
            <div class="stats-grid">
              <div class="stat-card urgent">
                <div class="stat-number urgent">3</div>
                <div class="stat-label">Signalements urgents</div>
              </div>
              <div class="stat-card warning">
                <div class="stat-number warning">8</div>
                <div class="stat-label">√Ä traiter</div>
              </div>
              <div class="stat-card success">
                <div class="stat-number success">15</div>
                <div class="stat-label">Trait√©s aujourd'hui</div>
              </div>
              <div class="stat-card">
                <div class="stat-number">98.2%</div>
                <div class="stat-label">Taux de conformit√©</div>
              </div>
            </div>

            <div class="card">
              <div class="card-title">üö® Signalements urgents √† traiter</div>

              <table class="data-table">
                <thead>
                  <tr>
                    <th>Priorit√©</th>
                    <th>Mat√©riel</th>
                    <th>Probl√®me signal√©</th>
                    <th>Signal√© par</th>
                    <th>Date/Lieu</th>
                    <th>Photos</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr style="background: rgba(239, 68, 68, 0.05)">
                    <td><span class="badge badge-red">üî¥ URGENT</span></td>
                    <td>
                      <strong>CAM-7 - Mercedes Actros</strong><br />
                      <small>IJ-789-KL | 287,560 km</small>
                    </td>
                    <td>
                      <strong>Fuite hydraulique syst√®me benne</strong><br />
                      <small style="color: var(--red)"
                        >‚ö†Ô∏è V√©hicule immobilis√©</small
                      >
                    </td>
                    <td>Sophie M√©canicien</td>
                    <td>
                      16/07/2025, 14:45<br />
                      <small>üìç Atelier Central</small>
                    </td>
                    <td>
                      <button
                        class="btn btn-warning btn-small"
                        onclick="viewPhotosGallery('CAM-7-hydraulique')"
                      >
                        üì∏ 8 photos
                      </button>
                    </td>
                    <td>
                      <button
                        class="btn btn-success btn-small"
                        onclick="startIntervention('CAM-7')"
                      >
                        Traiter
                      </button>
                    </td>
                  </tr>
                  <tr style="background: rgba(239, 68, 68, 0.05)">
                    <td><span class="badge badge-red">üî¥ URGENT</span></td>
                    <td>
                      <strong>T003 - Iveco Daily</strong><br />
                      <small>RS-234-TU | 156,890 km</small>
                    </td>
                    <td>
                      <strong>Pneu avant gauche : crevaison</strong><br />
                      <small style="color: var(--red)"
                        >‚ö†Ô∏è S√©curit√© critique</small
                      >
                    </td>
                    <td>Jean Dupont</td>
                    <td>
                      Aujourd'hui, 16:30<br />
                      <small>üìç D√©p√¥t Saint-√âtienne</small>
                    </td>
                    <td>
                      <button
                        class="btn btn-warning btn-small"
                        onclick="viewPhotosGallery('T003-pneu')"
                      >
                        üì∏ 4 photos
                      </button>
                    </td>
                    <td>
                      <button
                        class="btn btn-success btn-small"
                        onclick="startIntervention('T003')"
                      >
                        Traiter
                      </button>
                    </td>
                  </tr>
                  <tr style="background: rgba(245, 158, 11, 0.05)">
                    <td>
                      <span class="badge badge-orange">üü† IMPORTANT</span>
                    </td>
                    <td>
                      <strong>U015 - Renault Master</strong><br />
                      <small>EF-456-GH | 89,340 km</small>
                    </td>
                    <td>
                      <strong>R√©troviseur cass√© c√¥t√© passager</strong><br />
                      <small>Impact sur visibilit√©</small>
                    </td>
                    <td>Marc Legrand (Partenaire)</td>
                    <td>
                      Aujourd'hui, 11:20<br />
                      <small>üìç Chantier BTP Lyon</small>
                    </td>
                    <td>
                      <button
                        class="btn btn-warning btn-small"
                        onclick="viewPhotosGallery('U015-retroviseur')"
                      >
                        üì∏ 5 photos
                      </button>
                    </td>
                    <td>
                      <button
                        class="btn btn-primary btn-small"
                        onclick="planIntervention('U015')"
                      >
                        Planifier
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="card">
              <div class="card-title">üì∏ Photos et diagnostics r√©cents</div>

              <table class="data-table">
                <thead>
                  <tr>
                    <th>Mat√©riel</th>
                    <th>Photos</th>
                    <th>Diagnostic</th>
                    <th>Technicien</th>
                    <th>Date</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong>CAM-7</strong> - Mercedes Actros</td>
                    <td>8 photos</td>
                    <td>
                      <span class="badge badge-red">R√©paration urgente</span>
                    </td>
                    <td>Sophie M√©canicien</td>
                    <td>16/07/2025</td>
                    <td>
                      <button
                        class="btn btn-secondary btn-small"
                        onclick="viewPhotosGallery('CAM-7-diagnostic')"
                      >
                        Voir photos
                      </button>
                    </td>
                  </tr>
                  <tr>
                    <td><strong>T003</strong> - Iveco Daily</td>
                    <td>4 photos</td>
                    <td>
                      <span class="badge badge-orange">Changement pneu</span>
                    </td>
                    <td>Marc Dubois</td>
                    <td>Aujourd'hui</td>
                    <td>
                      <button
                        class="btn btn-secondary btn-small"
                        onclick="viewPhotosGallery('T003-diagnostic')"
                      >
                        Voir photos
                      </button>
                    </td>
                  </tr>
                  <tr>
                    <td><strong>U015</strong> - Renault Master</td>
                    <td>5 photos</td>
                    <td>
                      <span class="badge badge-yellow"
                        >Remplacement r√©troviseur</span
                      >
                    </td>
                    <td>Antoine Martin</td>
                    <td>Aujourd'hui</td>
                    <td>
                      <button
                        class="btn btn-secondary btn-small"
                        onclick="viewPhotosGallery('U015-diagnostic')"
                      >
                        Voir photos
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Section Suivi du mat√©riel -->
          <div id="vehicles-section" class="content-section">
            <div class="stats-grid">
              <div class="stat-card success">
                <div class="stat-number success">72</div>
                <div class="stat-label">Mat√©riels disponibles</div>
              </div>
              <div class="stat-card warning">
                <div class="stat-number warning">6</div>
                <div class="stat-label">En maintenance</div>
              </div>
              <div class="stat-card urgent">
                <div class="stat-number urgent">3</div>
                <div class="stat-label">Hors service</div>
              </div>
              <div class="stat-card">
                <div class="stat-number">81</div>
                <div class="stat-label">Total mat√©riels</div>
              </div>
            </div>

            <div class="card">
              <div class="card-title">
                üöõ Gestion de la disponibilit√© du mat√©riel
              </div>

              <table class="data-table">
                <thead>
                  <tr>
                    <th>Mat√©riel</th>
                    <th>Statut actuel</th>
                    <th>Disponibilit√©</th>
                    <th>Derni√®re intervention</th>
                    <th>Prochaine √©ch√©ance</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>
                      <strong>T001 - Iveco Daily</strong><br />
                      <small>AB-123-CD | 145,680 km</small>
                    </td>
                    <td><span class="badge badge-green">En service</span></td>
                    <td>
                      <div class="availability-toggle">
                        <div
                          class="toggle active"
                          onclick="toggleAvailability(this, 'T001')"
                        ></div>
                        <span class="toggle-label">Disponible</span>
                      </div>
                    </td>
                    <td>
                      Entretien g√©n√©ral<br />
                      <small>10/07/2025</small>
                    </td>
                    <td>
                      Hayon: 15/08/2025<br />
                      <small style="color: var(--orange)">(‚ö†Ô∏è 4 jours)</small>
                    </td>
                    <td>
                      <button
                        class="btn btn-primary btn-small"
                        onclick="scheduleIntervention('T001')"
                      >
                        Programmer
                      </button>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <strong>CAM-7 - Mercedes Actros</strong><br />
                      <small>IJ-789-KL | 287,560 km</small>
                    </td>
                    <td><span class="badge badge-red">Hors service</span></td>
                    <td>
                      <div class="availability-toggle">
                        <div
                          class="toggle"
                          onclick="toggleAvailability(this, 'CAM-7')"
                        ></div>
                        <span class="toggle-label">Indisponible</span>
                      </div>
                    </td>
                    <td>
                      R√©paration hydraulique<br />
                      <small>En cours</small>
                    </td>
                    <td>
                      Fin intervention<br />
                      <small>Demain 17h00</small>
                    </td>
                    <td>
                      <button
                        class="btn btn-warning btn-small"
                        onclick="updateIntervention('CAM-7')"
                      >
                        Suivre
                      </button>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <strong>U015 - Renault Master</strong><br />
                      <small>EF-456-GH | 89,340 km</small>
                    </td>
                    <td><span class="badge badge-yellow">Maintenance</span></td>
                    <td>
                      <div class="availability-toggle">
                        <div
                          class="toggle"
                          onclick="toggleAvailability(this, 'U015')"
                        ></div>
                        <span class="toggle-label">Indisponible</span>
                      </div>
                    </td>
                    <td>
                      Remplacement r√©troviseur<br />
                      <small>Planifi√© demain</small>
                    </td>
                    <td>
                      Entretien g√©n√©ral<br />
                      <small>30/08/2025</small>
                    </td>
                    <td>
                      <button
                        class="btn btn-secondary btn-small"
                        onclick="viewMaintenance('U015')"
                      >
                        D√©tails
                      </button>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <strong>TRR-08 - Volvo FH16</strong><br />
                      <small>VL-567-FH | 423,890 km</small>
                    </td>
                    <td>
                      <span class="badge badge-purple">Chronotachygraphe</span>
                    </td>
                    <td>
                      <div class="availability-toggle">
                        <div
                          class="toggle"
                          onclick="toggleAvailability(this, 'TRR-08')"
                        ></div>
                        <span class="toggle-label">Indisponible</span>
                      </div>
                    </td>
                    <td>
                      √âtalonnage chrono<br />
                      <small>Planifi√© 22/07/2025</small>
                    </td>
                    <td>
                      Contr√¥le technique<br />
                      <small>12/09/2025</small>
                    </td>
                    <td>
                      <button
                        class="btn btn-purple btn-small"
                        style="background: var(--purple)"
                        onclick="manageChrono('TRR-08')"
                      >
                        Chrono
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="card">
              <div class="card-title">
                üìÖ Planning des interventions, contr√¥les et chronotachygraphes
              </div>

              <div class="planning-calendar">
                <div class="calendar-header">
                  <div class="calendar-month">Ao√ªt 2025</div>
                  <div class="calendar-nav">
                    <button
                      class="btn btn-secondary btn-small"
                      onclick="previousMonth()"
                    >
                      ‚Äπ
                    </button>
                    <button
                      class="btn btn-secondary btn-small"
                      onclick="nextMonth()"
                    >
                      ‚Ä∫
                    </button>
                  </div>
                </div>

                <div class="calendar-grid">
                  <!-- En-t√™tes des jours -->
                  <div class="calendar-day-header">Lun</div>
                  <div class="calendar-day-header">Mar</div>
                  <div class="calendar-day-header">Mer</div>
                  <div class="calendar-day-header">Jeu</div>
                  <div class="calendar-day-header">Ven</div>
                  <div class="calendar-day-header">Sam</div>
                  <div class="calendar-day-header">Dim</div>

                  <!-- Jours du mois -->
                  <div class="calendar-day">
                    <div class="calendar-day-number">1</div>
                  </div>
                  <div class="calendar-day">
                    <div class="calendar-day-number">2</div>
                  </div>
                  <div class="calendar-day">
                    <div class="calendar-day-number">3</div>
                  </div>
                  <div class="calendar-day">
                    <div class="calendar-day-number">4</div>
                  </div>
                  <div class="calendar-day">
                    <div class="calendar-day-number">5</div>
                  </div>
                  <div class="calendar-day">
                    <div class="calendar-day-number">6</div>
                  </div>
                  <div class="calendar-day">
                    <div class="calendar-day-number">7</div>
                  </div>
                  <div class="calendar-day">
                    <div class="calendar-day-number">8</div>
                  </div>
                  <div class="calendar-day">
                    <div class="calendar-day-number">9</div>
                  </div>
                  <div class="calendar-day">
                    <div class="calendar-day-number">10</div>
                  </div>
                  <div class="calendar-day today">
                    <div class="calendar-day-number">11</div>
                    <div class="calendar-event event-control">CT CAM-12</div>
                  </div>
                  <div class="calendar-day">
                    <div class="calendar-day-number">12</div>
                  </div>
                  <div class="calendar-day">
                    <div class="calendar-day-number">13</div>
                  </div>
                  <div class="calendar-day">
                    <div class="calendar-day-number">14</div>
                  </div>
                  <div class="calendar-day">
                    <div class="calendar-day-number">15</div>
                    <div class="calendar-event event-maintenance">
                      Hayon T001
                    </div>
                  </div>
                  <div class="calendar-day">
                    <div class="calendar-day-number">16</div>
                  </div>
                  <div class="calendar-day">
                    <div class="calendar-day-number">17</div>
                  </div>
                  <div class="calendar-day">
                    <div class="calendar-day-number">18</div>
                  </div>
                  <div class="calendar-day">
                    <div class="calendar-day-number">19</div>
                  </div>
                  <div class="calendar-day">
                    <div class="calendar-day-number">20</div>
                    <div class="calendar-event event-control">CT CAM-7</div>
                  </div>
                  <div class="calendar-day">
                    <div class="calendar-day-number">21</div>
                  </div>
                  <div class="calendar-day">
                    <div class="calendar-day-number">22</div>
                    <div class="calendar-event event-chrono">Chrono TRR-08</div>
                  </div>
                  <div class="calendar-day">
                    <div class="calendar-day-number">23</div>
                  </div>
                  <div class="calendar-day">
                    <div class="calendar-day-number">24</div>
                  </div>
                  <div class="calendar-day">
                    <div class="calendar-day-number">25</div>
                  </div>
                  <div class="calendar-day">
                    <div class="calendar-day-number">26</div>
                  </div>
                  <div class="calendar-day">
                    <div class="calendar-day-number">27</div>
                  </div>
                  <div class="calendar-day">
                    <div class="calendar-day-number">28</div>
                    <div class="calendar-event event-maintenance">
                      Entretien T005
                    </div>
                  </div>
                  <div class="calendar-day">
                    <div class="calendar-day-number">29</div>
                  </div>
                  <div class="calendar-day">
                    <div class="calendar-day-number">30</div>
                    <div class="calendar-event event-maintenance">
                      Entretien U015
                    </div>
                  </div>
                  <div class="calendar-day">
                    <div class="calendar-day-number">31</div>
                  </div>
                </div>
              </div>

              <div
                style="
                  margin-top: 20px;
                  display: grid;
                  grid-template-columns: 1fr 1fr 1fr;
                  gap: 16px;
                "
              >
                <div style="display: flex; align-items: center; gap: 8px">
                  <div
                    style="
                      width: 16px;
                      height: 16px;
                      background: var(--orange);
                      border-radius: 4px;
                    "
                  ></div>
                  <span style="font-size: 0.85rem">Maintenance pr√©ventive</span>
                </div>
                <div style="display: flex; align-items: center; gap: 8px">
                  <div
                    style="
                      width: 16px;
                      height: 16px;
                      background: var(--red);
                      border-radius: 4px;
                    "
                  ></div>
                  <span style="font-size: 0.85rem">Contr√¥le technique</span>
                </div>
                <div style="display: flex; align-items: center; gap: 8px">
                  <div
                    style="
                      width: 16px;
                      height: 16px;
                      background: var(--purple);
                      border-radius: 4px;
                    "
                  ></div>
                  <span style="font-size: 0.85rem">Chronotachygraphe</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Section Ajouter mat√©riel -->
          <div id="add-vehicle-section" class="content-section">
            <div class="card">
              <div class="card-title">
                Enregistrer un nouveau mat√©riel
                <span
                  style="
                    font-size: 0.8rem;
                    font-weight: normal;
                    color: var(--gray-600);
                  "
                >
                  Triple identification : Billun + Interne + Plaque
                </span>
              </div>

              <div class="notification success" id="vehicle-notification">
                ‚úì Mat√©riel enregistr√© avec succ√®s ! QR Code g√©n√©r√©
                automatiquement.
              </div>

              <form id="vehicle-form">
                <div class="form-grid">
                  <!-- Informations de base -->
                  <div class="form-group full-width">
                    <h4
                      style="
                        margin: 0 0 16px 0;
                        color: var(--blue-primary);
                        border-bottom: 2px solid var(--blue-bg);
                        padding-bottom: 8px;
                      "
                    >
                      üìã Informations g√©n√©rales
                    </h4>
                  </div>

                  <div class="form-group">
                    <label class="form-label">Identifiant interne *</label>
                    <input
                      type="text"
                      class="form-input"
                      name="internalId"
                      required
                      placeholder="T001, CAM-15, BTP-A7..."
                    />
                  </div>
                  <div class="form-group">
                    <label class="form-label">Plaque d'immatriculation</label>
                    <input
                      type="text"
                      class="form-input"
                      name="plate"
                      placeholder="AB-123-CD (si applicable)"
                    />
                  </div>
                  <div class="form-group">
                    <label class="form-label">Nom/D√©signation *</label>
                    <input
                      type="text"
                      class="form-input"
                      name="name"
                      required
                      placeholder="Ex: Camion Iveco Daily"
                    />
                  </div>
                  <div class="form-group">
                    <label class="form-label">D√©p√¥t d'affectation</label>
                    <select class="form-select" name="depot">
                      <option value="">Choisir un d√©p√¥t</option>
                      <option value="siege">
                        Si√®ge Social - Saint-√âtienne
                      </option>
                      <option value="lyon">D√©p√¥t Lyon</option>
                      <option value="marseille">D√©p√¥t Marseille</option>
                      <option value="atelier-central">Atelier Central</option>
                      <option value="parc-mobile">
                        Parc mobile (sans affectation)
                      </option>
                    </select>
                  </div>

                  <!-- Cat√©gorie et type de mat√©riel -->
                  <div class="form-group full-width">
                    <h4
                      style="
                        margin: 20px 0 16px 0;
                        color: var(--blue-primary);
                        border-bottom: 2px solid var(--blue-bg);
                        padding-bottom: 8px;
                      "
                    >
                      üöõ Type de mat√©riel
                    </h4>
                  </div>

                  <div class="form-group">
                    <label class="form-label">Cat√©gorie principale *</label>
                    <select
                      class="form-select"
                      name="category"
                      required
                      onchange="updateTypeOptions(this)"
                    >
                      <option value="">S√©lectionner une cat√©gorie</option>
                      <option value="vehicule">üöõ V√©hicules</option>
                      <option value="remorque">üèóÔ∏è Remorques</option>
                      <option value="manutention">üè≠ Manutention</option>
                      <option value="autre">‚ûï Autre mat√©riel</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Type sp√©cifique *</label>
                    <select
                      class="form-select"
                      name="type"
                      required
                      id="typeSelect"
                    >
                      <option value="">Choisir d'abord une cat√©gorie</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Marque</label>
                    <input
                      type="text"
                      class="form-input"
                      name="brand"
                      placeholder="Iveco, Renault, Caterpillar..."
                    />
                  </div>
                  <div class="form-group">
                    <label class="form-label">Mod√®le</label>
                    <input
                      type="text"
                      class="form-input"
                      name="model"
                      placeholder="Daily, Master, 950GC..."
                    />
                  </div>

                  <!-- Informations techniques -->
                  <div class="form-group full-width">
                    <h4
                      style="
                        margin: 20px 0 16px 0;
                        color: var(--blue-primary);
                        border-bottom: 2px solid var(--blue-bg);
                        padding-bottom: 8px;
                      "
                    >
                      üîß Donn√©es techniques
                    </h4>
                  </div>

                  <div class="form-group">
                    <label class="form-label">Ann√©e mise en service</label>
                    <input
                      type="number"
                      class="form-input"
                      name="year"
                      placeholder="2020"
                      min="1990"
                      max="2025"
                    />
                  </div>
                  <div class="form-group">
                    <label class="form-label">Kilom√©trage/Heures actuels</label>
                    <input
                      type="number"
                      class="form-input"
                      name="mileage"
                      placeholder="150000"
                      min="0"
                    />
                    <small style="color: var(--gray-600); font-size: 0.75rem"
                      >En km (ou heures pour les engins)</small
                    >
                  </div>
                  <div class="form-group">
                    <label class="form-label">Type de carburant</label>
                    <select class="form-select" name="fuel">
                      <option value="">S√©lectionner un carburant</option>
                      <option value="diesel">Diesel</option>
                      <option value="essence">Essence</option>
                      <option value="gpl">GPL (Gaz de P√©trole Liqu√©fi√©)</option>
                      <option value="gnv">GNV (Gaz Naturel V√©hicule)</option>
                      <option value="electrique">√âlectrique</option>
                      <option value="hybride">Hybride diesel</option>
                      <option value="autre">Autre</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Poids √† vide (kg)</label>
                    <input
                      type="number"
                      class="form-input"
                      name="emptyWeight"
                      placeholder="3500"
                      min="0"
                    />
                  </div>

                  <!-- √âquipements sp√©ciaux -->
                  <div class="form-group full-width">
                    <h4
                      style="
                        margin: 20px 0 16px 0;
                        color: var(--blue-primary);
                        border-bottom: 2px solid var(--blue-bg);
                        padding-bottom: 8px;
                      "
                    >
                      ‚ö†Ô∏è √âquipements sp√©ciaux
                    </h4>
                  </div>

                  <div class="form-group">
                    <label class="form-label">
                      <input
                        type="checkbox"
                        name="adrPlate"
                        style="margin-right: 8px"
                      />
                      Plaque ADR (mati√®res dangereuses)
                    </label>
                  </div>
                  <div class="form-group">
                    <label class="form-label">
                      <input
                        type="checkbox"
                        name="hayon"
                        style="margin-right: 8px"
                      />
                      Hayon √©l√©vateur
                    </label>
                  </div>
                  <div class="form-group">
                    <label class="form-label">
                      <input
                        type="checkbox"
                        name="frigo"
                        style="margin-right: 8px"
                      />
                      Groupe frigorifique
                    </label>
                  </div>
                  <div class="form-group">
                    <label class="form-label">
                      <input
                        type="checkbox"
                        name="grue"
                        style="margin-right: 8px"
                      />
                      Grue embarqu√©e
                    </label>
                  </div>
                  <div class="form-group">
                    <label class="form-label">
                      <input
                        type="checkbox"
                        name="benne"
                        style="margin-right: 8px"
                      />
                      Benne basculante
                    </label>
                  </div>
                  <div class="form-group">
                    <label class="form-label">
                      <input
                        type="checkbox"
                        name="chrono"
                        style="margin-right: 8px"
                      />
                      Chronotachygraphe num√©rique
                    </label>
                  </div>

                  <!-- Statut initial -->
                  <div class="form-group full-width">
                    <h4
                      style="
                        margin: 20px 0 16px 0;
                        color: var(--blue-primary);
                        border-bottom: 2px solid var(--blue-bg);
                        padding-bottom: 8px;
                      "
                    >
                      üìä Statut et disponibilit√©
                    </h4>
                  </div>

                  <div class="form-group">
                    <label class="form-label">Statut initial</label>
                    <select class="form-select" name="status">
                      <option value="available">‚úÖ Disponible</option>
                      <option value="maintenance">‚ö†Ô∏è En maintenance</option>
                      <option value="unavailable">‚ùå Indisponible</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="form-label"
                      >Date prochain contr√¥le technique</label
                    >
                    <input
                      type="date"
                      class="form-input"
                      name="nextTechnicalControl"
                    />
                  </div>

                  <div class="form-group full-width">
                    <button
                      type="submit"
                      class="btn btn-primary"
                      style="margin-top: 24px; padding: 12px 24px"
                    >
                      üìù Enregistrer le mat√©riel complet
                    </button>
                  </div>
                </div>
              </form>
            </div>
          </div>

          <!-- Section Personnel d'atelier -->
          <div id="personnel-section" class="content-section">
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-number">8</div>
                <div class="stat-label">Personnel total</div>
              </div>
              <div class="stat-card success">
                <div class="stat-number success">7</div>
                <div class="stat-label">Actifs</div>
              </div>
              <div class="stat-card warning">
                <div class="stat-number warning">1</div>
                <div class="stat-label">En formation</div>
              </div>
              <div class="stat-card">
                <div class="stat-number">3</div>
                <div class="stat-label">Sites couverts</div>
              </div>
            </div>

            <div class="card">
              <div class="card-title">
                üë• √âquipe d'atelier Transport Dubois
                <button
                  class="btn btn-primary btn-small"
                  onclick="showAddPersonModal()"
                >
                  + Ajouter personne
                </button>
              </div>

              <div class="notification success" id="person-notification">
                ‚úì Personnel ajout√© avec succ√®s ! Identifiants envoy√©s par email.
              </div>

              <table class="data-table">
                <thead>
                  <tr>
                    <th>Nom</th>
                    <th>Email</th>
                    <th>Fonction</th>
                    <th>Atelier/Site</th>
                    <th>Sp√©cialit√©s</th>
                    <th>Statut</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong>Sophie M√©canicien</strong></td>
                    <td>sophie.mecanicien@transport-dubois.fr</td>
                    <td>
                      <span class="badge badge-orange">Chef d'atelier</span>
                    </td>
                    <td>Atelier Central</td>
                    <td>
                      <small>Hydraulique, Pneumatique</small><br />
                      <small style="color: var(--blue-primary)"
                        >üéì Habilitation ADR</small
                      >
                    </td>
                    <td><span class="badge badge-green">Actif</span></td>
                    <td>
                      <button class="btn btn-secondary btn-small">
                        Modifier
                      </button>
                    </td>
                  </tr>
                  <tr>
                    <td><strong>Marc Dubois</strong></td>
                    <td>marc.dubois@transport-dubois.fr</td>
                    <td>
                      <span class="badge badge-blue">M√©canicien senior</span>
                    </td>
                    <td>Atelier Central</td>
                    <td>
                      <small>M√©canique g√©n√©rale, Diagnostic</small><br />
                      <small style="color: var(--green)">üéì Formation CT</small>
                    </td>
                    <td><span class="badge badge-green">Actif</span></td>
                    <td>
                      <button class="btn btn-secondary btn-small">
                        Modifier
                      </button>
                    </td>
                  </tr>
                  <tr>
                    <td><strong>Antoine Martin</strong></td>
                    <td>antoine.martin@transport-dubois.fr</td>
                    <td><span class="badge badge-blue">M√©canicien</span></td>
                    <td>D√©p√¥t Lyon</td>
                    <td>
                      <small>Entretien pr√©ventif</small><br />
                      <small style="color: var(--purple)"
                        >üéì Formation carrosserie</small
                      >
                    </td>
                    <td><span class="badge badge-green">Actif</span></td>
                    <td>
                      <button class="btn btn-secondary btn-small">
                        Modifier
                      </button>
                    </td>
                  </tr>
                  <tr>
                    <td><strong>Julie Lefort</strong></td>
                    <td>julie.lefort@transport-dubois.fr</td>
                    <td>
                      <span class="badge badge-purple">√âlectricienne</span>
                    </td>
                    <td>Atelier Central</td>
                    <td>
                      <small>√âlectricit√©, √âlectronique</small><br />
                      <small style="color: var(--orange)"
                        >üéì Chronotachygraphe</small
                      >
                    </td>
                    <td><span class="badge badge-green">Actif</span></td>
                    <td>
                      <button class="btn btn-secondary btn-small">
                        Modifier
                      </button>
                    </td>
                  </tr>
                  <tr>
                    <td><strong>Thomas Frigoriste</strong></td>
                    <td>thomas.frigoriste@transport-dubois.fr</td>
                    <td><span class="badge badge-blue">Frigoriste</span></td>
                    <td>D√©p√¥t Marseille</td>
                    <td>
                      <small>Froid industriel, Climatisation</small><br />
                      <small style="color: var(--green)"
                        >üéì Fluides frigorig√®nes</small
                      >
                    </td>
                    <td><span class="badge badge-green">Actif</span></td>
                    <td>
                      <button class="btn btn-secondary btn-small">
                        Modifier
                      </button>
                    </td>
                  </tr>
                  <tr>
                    <td><strong>Lucas Carrossier</strong></td>
                    <td>lucas.carrossier@transport-dubois.fr</td>
                    <td><span class="badge badge-yellow">Carrossier</span></td>
                    <td>Atelier Central</td>
                    <td>
                      <small>Carrosserie, Peinture, Soudure</small><br />
                      <small style="color: var(--blue-primary)"
                        >üéì Soudure certifi√©e</small
                      >
                    </td>
                    <td><span class="badge badge-green">Actif</span></td>
                    <td>
                      <button class="btn btn-secondary btn-small">
                        Modifier
                      </button>
                    </td>
                  </tr>
                  <tr>
                    <td><strong>Maxime Pneu</strong></td>
                    <td>maxime.pneu@transport-dubois.fr</td>
                    <td>
                      <span class="badge" style="background: #666; color: white"
                        >Pneumaticien</span
                      >
                    </td>
                    <td>√âquipe mobile</td>
                    <td>
                      <small>Pneumatiques, Jantes</small><br />
                      <small style="color: var(--purple)">üéì CACES R489</small>
                    </td>
                    <td><span class="badge badge-green">Actif</span></td>
                    <td>
                      <button class="btn btn-secondary btn-small">
                        Modifier
                      </button>
                    </td>
                  </tr>
                  <tr>
                    <td><strong>Emma Apprentie</strong></td>
                    <td>emma.apprentie@transport-dubois.fr</td>
                    <td><span class="badge badge-green">Apprentie</span></td>
                    <td>Atelier Central</td>
                    <td>
                      <small>Formation m√©canique g√©n√©rale</small><br />
                      <small style="color: var(--yellow)"
                        >üìö CAP en cours</small
                      >
                    </td>
                    <td>
                      <span class="badge badge-yellow">En formation</span>
                    </td>
                    <td>
                      <button class="btn btn-secondary btn-small">
                        Modifier
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="card">
              <div class="card-title">
                üìä R√©partition par site et sp√©cialit√©s
              </div>

              <div
                style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px"
              >
                <div>
                  <h4 style="margin-bottom: 16px; color: var(--gray-800)">
                    üè≠ R√©partition par site
                  </h4>
                  <div style="margin-bottom: 12px">
                    <strong>Atelier Central :</strong> 5 personnes<br />
                    <small style="color: var(--gray-600)"
                      >Chef d'atelier, 2 m√©caniciens, √©lectricienne, carrossier,
                      apprentie</small
                    >
                  </div>
                  <div style="margin-bottom: 12px">
                    <strong>D√©p√¥t Lyon :</strong> 1 personne<br />
                    <small style="color: var(--gray-600)">M√©canicien</small>
                  </div>
                  <div style="margin-bottom: 12px">
                    <strong>D√©p√¥t Marseille :</strong> 1 personne<br />
                    <small style="color: var(--gray-600)"
                      >Frigoriste sp√©cialis√©</small
                    >
                  </div>
                  <div style="margin-bottom: 12px">
                    <strong>√âquipe mobile :</strong> 1 personne<br />
                    <small style="color: var(--gray-600)"
                      >Pneumaticien itin√©rant</small
                    >
                  </div>
                </div>
                <div>
                  <h4 style="margin-bottom: 16px; color: var(--gray-800)">
                    üîß Sp√©cialit√©s techniques
                  </h4>
                  <div style="margin-bottom: 8px">
                    <strong>M√©canique g√©n√©rale :</strong> 4 personnes
                  </div>
                  <div style="margin-bottom: 8px">
                    <strong>Hydraulique/Pneumatique :</strong> 3 personnes
                  </div>
                  <div style="margin-bottom: 8px">
                    <strong>√âlectricit√©/√âlectronique :</strong> 2 personnes
                  </div>
                  <div style="margin-bottom: 8px">
                    <strong>Froid industriel :</strong> 1 personne
                  </div>
                  <div style="margin-bottom: 8px">
                    <strong>Carrosserie/Soudure :</strong> 1 personne
                  </div>
                  <div style="margin-bottom: 8px">
                    <strong>Diagnostic √©lectronique :</strong> 2 personnes
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Section Application Mobile -->
          <div id="mobile-section" class="content-section">
            <div class="card">
              <div class="card-title">Application Billun Conducteur</div>

              <div
                style="
                  display: grid;
                  grid-template-columns: 1fr 2fr;
                  gap: 30px;
                  align-items: start;
                "
              >
                <div style="text-align: center">
                  <div
                    style="
                      width: 120px;
                      height: 120px;
                      background: var(--blue-primary);
                      border-radius: 20px;
                      margin: 0 auto 20px;
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      color: white;
                      font-size: 48px;
                    "
                  >
                    üì±
                  </div>
                  <h3 style="color: var(--blue-primary); margin-bottom: 16px">
                    Billun Mobile
                  </h3>
                  <p
                    style="
                      color: var(--gray-600);
                      font-size: 0.9rem;
                      margin-bottom: 20px;
                    "
                  >
                    Application Android pour vos conducteurs et techniciens
                  </p>
                  <div style="display: flex; flex-direction: column; gap: 12px">
                    <button class="btn btn-primary" onclick="downloadAPK()">
                      üì• T√©l√©charger APK
                    </button>
                    <button
                      class="btn btn-secondary"
                      onclick="sendDownloadLinks()"
                    >
                      ‚úâÔ∏è Envoyer par email
                    </button>
                  </div>
                </div>

                <div>
                  <h4 style="color: var(--gray-800); margin-bottom: 16px">
                    Fonctionnalit√©s principales :
                  </h4>
                  <ul
                    style="
                      color: var(--gray-600);
                      line-height: 1.8;
                      margin-bottom: 20px;
                    "
                  >
                    <li>
                      <strong>‚úÖ Identification flexible :</strong> QR Code, ID
                      interne, ou plaque d'immatriculation
                    </li>
                    <li>
                      <strong>üì∏ Photos obligatoires :</strong> Minimum 4 photos
                      par prise en charge
                    </li>
                    <li>
                      <strong>üîç Signalement d'anomalies :</strong> Syst√®me de
                      codes couleur (üü¢üü°üü†üî¥)
                    </li>
                    <li>
                      <strong>üìç G√©olocalisation :</strong> Enregistrement
                      automatique du lieu
                    </li>
                    <li>
                      <strong>üîÑ Mode hors-ligne :</strong> Synchronisation
                      diff√©r√©e
                    </li>
                    <li>
                      <strong>ü§ù Partenariats :</strong> Acc√®s au mat√©riel des
                      entreprises partenaires
                    </li>
                  </ul>

                  <h4 style="color: var(--gray-800); margin-bottom: 12px">
                    Installation :
                  </h4>
                  <ol
                    style="
                      color: var(--gray-600);
                      line-height: 1.6;
                      font-size: 0.9rem;
                    "
                  >
                    <li>
                      T√©l√©charger le fichier APK depuis le bouton ci-contre
                    </li>
                    <li>
                      Autoriser l'installation d'applications tierces sur
                      Android
                    </li>
                    <li>
                      Installer l'application et se connecter avec les
                      identifiants Billun
                    </li>
                    <li>
                      Autoriser l'acc√®s √† la cam√©ra et √† la g√©olocalisation
                    </li>
                  </ol>
                </div>
              </div>
            </div>

            <div class="card">
              <div class="card-title">Utilisateurs de l'application</div>
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Utilisateur</th>
                    <th>R√¥le</th>
                    <th>Derni√®re utilisation</th>
                    <th>Photos prises</th>
                    <th>Version app</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong>Jean Dupont</strong></td>
                    <td><span class="badge badge-yellow">Conducteur</span></td>
                    <td>Aujourd'hui, 12:15</td>
                    <td>8 photos (2 v√©hicules)</td>
                    <td>v1.2.1</td>
                  </tr>
                  <tr>
                    <td><strong>Sophie Moreau</strong></td>
                    <td>
                      <span class="badge badge-orange">Chef d'atelier</span>
                    </td>
                    <td>Aujourd'hui, 16:20</td>
                    <td>12 photos (intervention)</td>
                    <td>v1.2.1</td>
                  </tr>
                  <tr>
                    <td><strong>Marie Dubois</strong></td>
                    <td><span class="badge badge-green">Gestionnaire</span></td>
                    <td>Hier, 18:45</td>
                    <td>4 photos (contr√¥le)</td>
                    <td>v1.2.1</td>
                  </tr>
                  <tr>
                    <td><strong>L√©a M√©canique</strong></td>
                    <td>
                      <span class="badge badge-purple">M√©canicienne</span>
                    </td>
                    <td>Aujourd'hui, 14:30</td>
                    <td>6 photos (maintenance)</td>
                    <td>v1.2.1</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Modal de galerie photos -->
    <div id="photoGalleryModal" class="photo-gallery-modal">
      <div class="photo-gallery-content">
        <div class="photo-gallery-header">
          <h3 class="modal-title" id="galleryTitle">Photos d'inspection</h3>
          <button class="modal-close" onclick="closePhotoGallery()">
            &times;
          </button>
        </div>

        <div
          id="galleryInfo"
          style="
            margin-bottom: 20px;
            padding: 12px;
            background: var(--gray-50);
            border-radius: 8px;
          "
        >
          <!-- Informations dynamiques de l'inspection -->
        </div>

        <div id="photoGalleryGrid" class="photo-gallery-grid">
          <!-- Photos g√©n√©r√©es dynamiquement -->
        </div>
      </div>
    </div>

    <!-- Lightbox pour voir les photos en grand -->
    <div id="lightbox" class="lightbox">
      <button class="lightbox-close" onclick="closeLightbox()">&times;</button>
      <img id="lightboxImage" src="" alt="Photo en grand" />
    </div>

    <!-- Modal pour nouveau signalement -->
    <div id="newReportModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Nouveau signalement</h3>
          <button class="modal-close" onclick="closeModal('newReportModal')">
            &times;
          </button>
        </div>
        <form id="newReportForm">
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">Mat√©riel concern√© *</label>
              <select class="form-select" name="vehicle" required>
                <option value="">S√©lectionner un mat√©riel</option>
                <option value="T001">T001 - Iveco Daily</option>
                <option value="CAM-7">CAM-7 - Mercedes Actros</option>
                <option value="U015">U015 - Renault Master</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Priorit√© *</label>
              <select class="form-select" name="priority" required>
                <option value="">S√©lectionner la priorit√©</option>
                <option value="urgent">üî¥ Urgent - Immobilisation</option>
                <option value="important">üü† Important - S√©curit√©</option>
                <option value="normal">üü° Normal - Planifiable</option>
              </select>
            </div>
            <div class="form-group full-width">
              <label class="form-label">Description du probl√®me *</label>
              <textarea
                class="form-textarea"
                name="description"
                required
                placeholder="Description d√©taill√©e du probl√®me constat√©..."
              ></textarea>
            </div>
            <div class="form-group full-width">
              <button
                type="submit"
                class="btn btn-primary"
                style="margin-top: 16px"
              >
                üìù Cr√©er le signalement
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal pour ajouter du personnel -->
    <div id="addPersonModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Ajouter du personnel d'atelier</h3>
          <button class="modal-close" onclick="closeModal('addPersonModal')">
            &times;
          </button>
        </div>
        <form id="addPersonForm">
          <div class="form-grid">
            <div class="form-group full-width">
              <h4
                style="
                  margin: 0 0 16px 0;
                  color: var(--blue-primary);
                  border-bottom: 2px solid var(--blue-bg);
                  padding-bottom: 8px;
                "
              >
                üë§ Informations personnelles
              </h4>
            </div>

            <div class="form-group">
              <label class="form-label">Nom *</label>
              <input
                type="text"
                class="form-input"
                name="lastName"
                required
                placeholder="Dubois"
              />
            </div>
            <div class="form-group">
              <label class="form-label">Pr√©nom *</label>
              <input
                type="text"
                class="form-input"
                name="firstName"
                required
                placeholder="Marc"
              />
            </div>
            <div class="form-group full-width">
              <label class="form-label">Email professionnel *</label>
              <input
                type="email"
                class="form-input"
                name="email"
                required
                placeholder="marc.dubois@transport-dubois.fr"
              />
            </div>
            <div class="form-group">
              <label class="form-label">T√©l√©phone</label>
              <input
                type="tel"
                class="form-input"
                name="phone"
                placeholder="06 12 34 56 78"
              />
            </div>
            <div class="form-group">
              <label class="form-label">Date d'embauche</label>
              <input type="date" class="form-input" name="hireDate" />
            </div>

            <div class="form-group full-width">
              <h4
                style="
                  margin: 20px 0 16px 0;
                  color: var(--blue-primary);
                  border-bottom: 2px solid var(--blue-bg);
                  padding-bottom: 8px;
                "
              >
                üîß Fonction et affectation
              </h4>
            </div>

            <div class="form-group">
              <label class="form-label">Fonction principale *</label>
              <select
                class="form-select"
                name="function"
                required
                onchange="updateSpecialtiesOptions(this)"
              >
                <option value="">S√©lectionner une fonction</option>
                <option value="chef_atelier">üü† Chef d'atelier</option>
                <option value="mecanicien_senior">üîµ M√©canicien senior</option>
                <option value="mecanicien">üîµ M√©canicien</option>
                <option value="electricien">üü£ √âlectricien(ne)</option>
                <option value="frigoriste">üîµ Frigoriste</option>
                <option value="carrossier">üü° Carrossier</option>
                <option value="pneumaticien">‚ö´ Pneumaticien</option>
                <option value="technicien_diagnostic">
                  üî¥ Technicien diagnostic
                </option>
                <option value="apprenti">üü¢ Apprenti(e)</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Site d'affectation *</label>
              <select class="form-select" name="worksite" required>
                <option value="">Choisir un site</option>
                <option value="atelier-central">
                  üîß Atelier Central - Saint-√âtienne
                </option>
                <option value="depot-lyon">üè≠ Atelier D√©p√¥t Lyon</option>
                <option value="depot-marseille">
                  üè≠ Atelier D√©p√¥t Marseille
                </option>
                <option value="atelier-mobile">
                  üöê √âquipe mobile itin√©rante
                </option>
                <option value="multi-sites">
                  üåê Multi-sites (interventions)
                </option>
              </select>
            </div>

            <div class="form-group full-width">
              <h4
                style="
                  margin: 20px 0 16px 0;
                  color: var(--blue-primary);
                  border-bottom: 2px solid var(--blue-bg);
                  padding-bottom: 8px;
                "
              >
                üéì Comp√©tences et habilitations
              </h4>
            </div>

            <div class="form-group full-width">
              <label class="form-label">Sp√©cialit√©s techniques</label>
              <div
                style="
                  display: grid;
                  grid-template-columns: 1fr 1fr;
                  gap: 8px;
                  margin-top: 8px;
                "
              >
                <label style="display: flex; align-items: center; gap: 8px">
                  <input
                    type="checkbox"
                    name="specialties"
                    value="hydraulique"
                  />
                  Hydraulique
                </label>
                <label style="display: flex; align-items: center; gap: 8px">
                  <input
                    type="checkbox"
                    name="specialties"
                    value="pneumatique"
                  />
                  Pneumatique
                </label>
                <label style="display: flex; align-items: center; gap: 8px">
                  <input
                    type="checkbox"
                    name="specialties"
                    value="electricite"
                  />
                  √âlectricit√©/√âlectronique
                </label>
                <label style="display: flex; align-items: center; gap: 8px">
                  <input type="checkbox" name="specialties" value="froid" />
                  Froid industriel
                </label>
                <label style="display: flex; align-items: center; gap: 8px">
                  <input
                    type="checkbox"
                    name="specialties"
                    value="carrosserie"
                  />
                  Carrosserie/Peinture
                </label>
                <label style="display: flex; align-items: center; gap: 8px">
                  <input
                    type="checkbox"
                    name="specialties"
                    value="diagnostic"
                  />
                  Diagnostic √©lectronique
                </label>
                <label style="display: flex; align-items: center; gap: 8px">
                  <input type="checkbox" name="specialties" value="soudure" />
                  Soudure
                </label>
                <label style="display: flex; align-items: center; gap: 8px">
                  <input
                    type="checkbox"
                    name="specialties"
                    value="mecanique_generale"
                  />
                  M√©canique g√©n√©rale
                </label>
              </div>
            </div>

            <div class="form-group full-width">
              <label class="form-label">Habilitations et certifications</label>
              <div
                style="
                  display: grid;
                  grid-template-columns: 1fr 1fr;
                  gap: 8px;
                  margin-top: 8px;
                "
              >
                <label style="display: flex; align-items: center; gap: 8px">
                  <input type="checkbox" name="certifications" value="adr" />
                  ADR Mati√®res dangereuses
                </label>
                <label style="display: flex; align-items: center; gap: 8px">
                  <input type="checkbox" name="certifications" value="caces" />
                  CACES R489 (Chariots)
                </label>
                <label style="display: flex; align-items: center; gap: 8px">
                  <input
                    type="checkbox"
                    name="certifications"
                    value="controle_technique"
                  />
                  Contr√¥le technique VL/PL
                </label>
                <label style="display: flex; align-items: center; gap: 8px">
                  <input
                    type="checkbox"
                    name="certifications"
                    value="chronotachygraphe"
                  />
                  Chronotachygraphe num√©rique
                </label>
                <label style="display: flex; align-items: center; gap: 8px">
                  <input
                    type="checkbox"
                    name="certifications"
                    value="fluides_frigo"
                  />
                  Fluides frigorig√®nes
                </label>
                <label style="display: flex; align-items: center; gap: 8px">
                  <input
                    type="checkbox"
                    name="certifications"
                    value="soudure_certifiee"
                  />
                  Soudure certifi√©e
                </label>
                <label style="display: flex; align-items: center; gap: 8px">
                  <input
                    type="checkbox"
                    name="certifications"
                    value="habilitation_electrique"
                  />
                  Habilitation √©lectrique
                </label>
                <label style="display: flex; align-items: center; gap: 8px">
                  <input
                    type="checkbox"
                    name="certifications"
                    value="formation_constructeur"
                  />
                  Formation constructeur
                </label>
              </div>
            </div>

            <div class="form-group full-width">
              <h4
                style="
                  margin: 20px 0 16px 0;
                  color: var(--blue-primary);
                  border-bottom: 2px solid var(--blue-bg);
                  padding-bottom: 8px;
                "
              >
                ‚öôÔ∏è Acc√®s et permissions
              </h4>
            </div>

            <div class="form-group">
              <label class="form-label">Niveau d'acc√®s Billun</label>
              <select class="form-select" name="accessLevel">
                <option value="basic">üë§ Utilisateur de base</option>
                <option value="technician">
                  üîß Technicien (+ interventions)
                </option>
                <option value="supervisor">üë®‚Äçüíº Superviseur (+ planning)</option>
                <option value="manager">
                  üëë Responsable atelier (acc√®s complet)
                </option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Statut initial</label>
              <select class="form-select" name="status">
                <option value="active">‚úÖ Actif</option>
                <option value="training">üìö En formation</option>
                <option value="inactive">‚ùå Inactif</option>
              </select>
            </div>

            <div class="form-group full-width">
              <label class="form-label">Commentaires et remarques</label>
              <textarea
                class="form-textarea"
                name="comments"
                placeholder="Informations compl√©mentaires, formations en cours, projets sp√©ciaux..."
              ></textarea>
            </div>

            <div class="form-group full-width">
              <button
                type="submit"
                class="btn btn-primary"
                style="margin-top: 24px; padding: 12px 24px"
              >
                üë• Ajouter au personnel d'atelier
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <script>
      // Types de mat√©riel par cat√©gorie (repris du gestionnaire)
      const vehicleTypes = {
        vehicule: [
          { value: "camion", text: "üöö Camion", icon: "üöö" },
          { value: "camion_remorque", text: "üöõ Camion remorque", icon: "üöõ" },
          {
            value: "tracteur_routier",
            text: "üöú Tracteur routier",
            icon: "üöú",
          },
          { value: "camionnette", text: "üöê Camionnette", icon: "üöê" },
          { value: "voiture", text: "üöó Voiture", icon: "üöó" },
          { value: "utilitaire", text: "üöö Utilitaire", icon: "üöö" },
          { value: "autre_vehicule", text: "‚ûï Autre v√©hicule", icon: "üöõ" },
        ],
        remorque: [
          { value: "bache", text: "üé™ Remorque b√¢che", icon: "üé™" },
          { value: "frigo", text: "‚ùÑÔ∏è Remorque frigorifique", icon: "‚ùÑÔ∏è" },
          { value: "fourgon", text: "üì¶ Remorque fourgon", icon: "üì¶" },
          { value: "citerne", text: "üõ¢Ô∏è Citerne", icon: "üõ¢Ô∏è" },
          { value: "benne", text: "üèóÔ∏è Remorque benne", icon: "üèóÔ∏è" },
          { value: "plateau", text: "üìê Plateau", icon: "üìê" },
          { value: "autre_remorque", text: "‚ûï Autre remorque", icon: "üöõ" },
        ],
        manutention: [
          { value: "transpalette", text: "ü§ñ Transpalette manuel", icon: "ü§ñ" },
          {
            value: "transpalette_electrique",
            text: "‚ö° Transpalette √©lectrique",
            icon: "‚ö°",
          },
          {
            value: "chariot_elevateur",
            text: "üèóÔ∏è Chariot √©l√©vateur",
            icon: "üèóÔ∏è",
          },
          { value: "grue_mobile", text: "üèóÔ∏è Grue mobile", icon: "üèóÔ∏è" },
          { value: "engin_chantier", text: "üèóÔ∏è Engin de chantier", icon: "üèóÔ∏è" },
          {
            value: "autre_manutention",
            text: "‚ûï Autre √©quipement",
            icon: "ü§ñ",
          },
        ],
        autre: [
          {
            value: "groupe_electrogene",
            text: "‚ö° Groupe √©lectrog√®ne",
            icon: "‚ö°",
          },
          { value: "compresseur", text: "üí® Compresseur", icon: "üí®" },
          { value: "outillage", text: "üîß Outillage sp√©cialis√©", icon: "üîß" },
          { value: "autre_materiel", text: "‚ûï Autre mat√©riel", icon: "üîß" },
        ],
      };

      // Donn√©es d'exemple pour les photos (reprises du gestionnaire)
      const photoData = {
        "CAM-7-hydraulique": {
          title: "Signalement CAM-7 - Fuite hydraulique",
          vehicle: "CAM-7 - Mercedes Actros",
          date: "16/07/2025, 14:45",
          user: "Sophie M√©canicien",
          location: "Atelier Central",
          coordinates: "45.4215¬∞N, 4.3247¬∞E",
          status: "urgent",
          severity: "urgent",
          description:
            "Fuite hydraulique d√©tect√©e sur le syst√®me de benne - V√©hicule immobilis√©",
          photos: [
            {
              url: "https://images.unsplash.com/photo-1558618047-3c8c76ca7d13?w=400&h=300&fit=crop",
              title: "Vue g√©n√©rale v√©hicule",
              type: "vue_generale",
              status: "ok",
            },
            {
              url: "https://images.unsplash.com/photo-1621007947382-bb3c3994e3fb?w=400&h=300&fit=crop",
              title: "Syst√®me hydraulique - Fuite",
              type: "anomalie",
              status: "anomalie",
              anomaly: "Fuite importante d√©tect√©e",
            },
            {
              url: "https://images.unsplash.com/photo-1563897024140-8d92e8d8e9ae?w=400&h=300&fit=crop",
              title: "V√©rins hydrauliques",
              type: "anomalie",
              status: "anomalie",
              anomaly: "Joint d√©fectueux",
            },
            {
              url: "https://images.unsplash.com/photo-1554672723-d42a16e533db?w=400&h=300&fit=crop",
              title: "R√©servoir hydraulique",
              type: "verification",
              status: "ok",
            },
            {
              url: "https://images.unsplash.com/photo-1581092160562-40aa08e78837?w=400&h=300&fit=crop",
              title: "D√©tail fuite - Joint",
              type: "anomalie",
              status: "anomalie",
              anomaly: "Joint d'√©tanch√©it√© √† remplacer",
            },
            {
              url: "https://images.unsplash.com/photo-1581092918056-0c4c3acd3789?w=400&h=300&fit=crop",
              title: "Pompe hydraulique",
              type: "verification",
              status: "ok",
            },
            {
              url: "https://images.unsplash.com/photo-1563897024140-8d92e8d8e9ae?w=400&h=300&fit=crop",
              title: "Flexible hydraulique",
              type: "verification",
              status: "ok",
            },
            {
              url: "https://images.unsplash.com/photo-1551632346-8b72891df766?w=400&h=300&fit=crop",
              title: "Outils de diagnostic",
              type: "outil",
              status: "ok",
            },
          ],
        },
        "T003-pneu": {
          title: "Signalement T003 - Pneu crev√©",
          vehicle: "T003 - Iveco Daily",
          date: "Aujourd'hui, 16:30",
          user: "Jean Dupont",
          location: "D√©p√¥t Saint-√âtienne",
          coordinates: "45.4397¬∞N, 4.3872¬∞E",
          status: "urgent",
          severity: "urgent",
          description:
            "Pneu avant gauche crev√© - Risque d'√©clatement sur route",
          photos: [
            {
              url: "https://images.unsplash.com/photo-1580273916550-e323be2ae537?w=400&h=300&fit=crop",
              title: "Pneu avant gauche - Crevaison",
              type: "anomalie",
              status: "anomalie",
              anomaly: "Crevaison visible",
            },
            {
              url: "https://images.unsplash.com/photo-1614031040793-e6b2ff01893d?w=400&h=300&fit=crop",
              title: "D√©tail crevaison",
              type: "anomalie",
              status: "anomalie",
              anomaly: "Trou dans la bande de roulement",
            },
            {
              url: "https://images.unsplash.com/photo-1615906655593-ad0386982a0f?w=400&h=300&fit=crop",
              title: "Comparaison autres pneus",
              type: "comparaison",
              status: "ok",
            },
            {
              url: "https://images.unsplash.com/photo-1621007947382-bb3c3994e3fb?w=400&h=300&fit=crop",
              title: "Vue d'ensemble v√©hicule",
              type: "vue_generale",
              status: "ok",
            },
          ],
        },
        "U015-retroviseur": {
          title: "Signalement U015 - R√©troviseur cass√©",
          vehicle: "U015 - Renault Master",
          date: "Aujourd'hui, 11:20",
          user: "Marc Legrand (Partenaire BTP)",
          location: "Chantier BTP Lyon",
          coordinates: "45.7578¬∞N, 4.8320¬∞E",
          status: "important",
          severity: "important",
          description:
            "R√©troviseur c√¥t√© passager cass√© - Impact sur visibilit√©",
          photos: [
            {
              url: "https://images.unsplash.com/photo-1544829099-b9a0c5303bea?w=400&h=300&fit=crop",
              title: "R√©troviseur cass√© - Vue g√©n√©rale",
              type: "anomalie",
              status: "anomalie",
              anomaly: "R√©troviseur passager endommag√©",
            },
            {
              url: "https://images.unsplash.com/photo-1553726618-5f4da6b7e11c?w=400&h=300&fit=crop",
              title: "D√©tail des d√©g√¢ts",
              type: "anomalie",
              status: "anomalie",
              anomaly: "Glace fissur√©e",
            },
            {
              url: "https://images.unsplash.com/photo-1623634890676-42b5946afc34?w=400&h=300&fit=crop",
              title: "Support r√©troviseur",
              type: "verification",
              status: "ok",
            },
            {
              url: "https://images.unsplash.com/photo-1558618047-3c8c76ca7d13?w=400&h=300&fit=crop",
              title: "Vue c√¥t√© conducteur",
              type: "comparaison",
              status: "ok",
            },
            {
              url: "https://images.unsplash.com/photo-1621007947382-bb3c3994e3fb?w=400&h=300&fit=crop",
              title: "Vue d'ensemble v√©hicule",
              type: "vue_generale",
              status: "ok",
            },
          ],
        },
      };

      // Navigation entre sections
      document.addEventListener("DOMContentLoaded", function () {
        const navLinks = document.querySelectorAll(".nav-link");
        const sections = document.querySelectorAll(".content-section");
        const pageTitle = document.querySelector(".page-title");

        navLinks.forEach((link) => {
          link.addEventListener("click", function (e) {
            e.preventDefault();

            const targetSection = this.getAttribute("data-section");

            // Navigation
            navLinks.forEach((l) => l.classList.remove("active"));
            sections.forEach((s) => s.classList.remove("active"));

            this.classList.add("active");
            const section = document.getElementById(targetSection + "-section");
            if (section) {
              section.classList.add("active");
            }

            // Mise √† jour du titre
            const titles = {
              monitoring: "Signalements & Anomalies",
              vehicles: "Suivi du mat√©riel",
              "add-vehicle": "Ajouter mat√©riel",
              personnel: "Personnel d'atelier",
              mobile: "Application mobile",
            };

            if (titles[targetSection]) {
              pageTitle.textContent = titles[targetSection];
            }
          });
        });

        // Gestion des formulaires
        const vehicleForm = document.getElementById("vehicle-form");
        if (vehicleForm) {
          vehicleForm.addEventListener("submit", function (e) {
            e.preventDefault();
            showNotification("vehicle-notification");
            this.reset();
          });
        }

        const newReportForm = document.getElementById("newReportForm");
        if (newReportForm) {
          newReportForm.addEventListener("submit", function (e) {
            e.preventDefault();
            alert("Signalement cr√©√© avec succ√®s !");
            closeModal("newReportModal");
            this.reset();
          });
        }

        const addPersonForm = document.getElementById("addPersonForm");
        if (addPersonForm) {
          addPersonForm.addEventListener("submit", function (e) {
            e.preventDefault();
            showNotification("person-notification");
            closeModal("addPersonModal");
            this.reset();
          });
        }
      });

      // Mise √† jour des types selon la cat√©gorie
      function updateTypeOptions(categorySelect) {
        const typeSelect = document.getElementById("typeSelect");
        const category = categorySelect.value;

        // Vider les options
        typeSelect.innerHTML = "";

        if (category && vehicleTypes[category]) {
          vehicleTypes[category].forEach((type) => {
            const option = document.createElement("option");
            option.value = type.value;
            option.textContent = type.text;
            typeSelect.appendChild(option);
          });
        } else {
          const option = document.createElement("option");
          option.value = "";
          option.textContent = "Choisir d'abord une cat√©gorie";
          typeSelect.appendChild(option);
        }
      }

      // Fonction pour afficher la galerie de photos
      function viewPhotosGallery(photoId) {
        const data = photoData[photoId];
        if (!data) {
          alert(
            `Photos ${photoId}\n\nGalerie de photos avec annotations techniques...`
          );
          return;
        }

        const modal = document.getElementById("photoGalleryModal");
        const title = document.getElementById("galleryTitle");
        const info = document.getElementById("galleryInfo");
        const grid = document.getElementById("photoGalleryGrid");

        title.textContent = data.title;

        // Informations du signalement
        const statusClass =
          data.status === "urgent"
            ? "badge-red"
            : data.status === "important"
            ? "badge-orange"
            : "badge-yellow";
        const statusText =
          data.status === "urgent"
            ? "üî¥ Urgent"
            : data.status === "important"
            ? "üü† Important"
            : "üü° Normal";

        info.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div>
                        <strong>Mat√©riel :</strong> ${data.vehicle}<br>
                        <strong>Signal√© par :</strong> ${data.user}<br>
                        <strong>Date :</strong> ${data.date}
                    </div>
                    <div>
                        <strong>Localisation :</strong> ${data.location}<br>
                        <strong>Position GPS :</strong> <span style="font-family: monospace; font-size: 0.8rem; color: var(--gray-600); background: var(--gray-100); padding: 2px 6px; border-radius: 4px;">${data.coordinates}</span><br>
                        <strong>Nombre de photos :</strong> ${data.photos.length}<br>
                        <strong>Priorit√© :</strong> <span class="badge ${statusClass}">${statusText}</span>
                    </div>
                </div>
                <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid var(--orange); border-radius: 8px; padding: 16px; margin-top: 16px;">
                    <strong>Description :</strong><br>
                    ${data.description}
                </div>
            `;

        // Grille de photos
        grid.innerHTML = "";
        data.photos.forEach((photo, index) => {
          const photoDiv = document.createElement("div");
          photoDiv.className = "photo-item";

          const statusBadge =
            photo.status === "ok"
              ? '<span class="badge badge-green">‚úì Normal</span>'
              : photo.status === "anomalie"
              ? '<span class="badge badge-red">‚ö†Ô∏è Anomalie</span>'
              : '<span class="badge badge-orange">üîß V√©rification</span>';

          photoDiv.innerHTML = `
                    <img src="${photo.url}" alt="${
            photo.title
          }" onclick="openLightbox('${photo.url}', '${photo.title}')">
                    <div class="photo-info">
                        <div class="photo-title">${photo.title}</div>
                        <div class="photo-meta">
                            Type: ${photo.type}<br>
                            ${
                              photo.anomaly
                                ? `<small style="color: var(--red); font-weight: 600;">${photo.anomaly}</small>`
                                : ""
                            }
                        </div>
                        <div class="photo-status">${statusBadge}</div>
                    </div>
                `;
          grid.appendChild(photoDiv);
        });

        modal.classList.add("show");
      }

      // Fonction pour ouvrir le lightbox
      function openLightbox(imageUrl, title) {
        const lightbox = document.getElementById("lightbox");
        const image = document.getElementById("lightboxImage");

        image.src = imageUrl;
        image.alt = title;
        lightbox.classList.add("show");
      }

      // Fonction pour fermer le lightbox
      function closeLightbox() {
        document.getElementById("lightbox").classList.remove("show");
      }

      // Fonction pour fermer la galerie de photos
      function closePhotoGallery() {
        document.getElementById("photoGalleryModal").classList.remove("show");
      }

      // Fonctions utilitaires
      function showNotification(id) {
        const notification = document.getElementById(id);
        if (notification) {
          notification.classList.add("show");
          setTimeout(() => {
            notification.classList.remove("show");
          }, 5000);
        }
      }

      function showNewReportModal() {
        document.getElementById("newReportModal").classList.add("show");
      }

      function showAddPersonModal() {
        document.getElementById("addPersonModal").classList.add("show");
      }

      function closeModal(modalId) {
        document.getElementById(modalId).classList.remove("show");
      }

      // Gestion de la disponibilit√© du mat√©riel
      function toggleAvailability(toggleElement, vehicleId) {
        const isActive = toggleElement.classList.contains("active");
        const label = toggleElement.nextElementSibling;

        if (isActive) {
          toggleElement.classList.remove("active");
          label.textContent = "Indisponible";
          label.style.color = "var(--red)";

          // Mettre √† jour le statut dans le tableau
          const row = toggleElement.closest("tr");
          const statusBadge = row.querySelector(".badge");
          statusBadge.className = "badge badge-red";
          statusBadge.textContent = "Hors service";

          alert(
            `${vehicleId} marqu√© comme INDISPONIBLE\n\nLe mat√©riel n'appara√Ætra plus dans les plannings de mission.`
          );
        } else {
          toggleElement.classList.add("active");
          label.textContent = "Disponible";
          label.style.color = "var(--green)";

          // Mettre √† jour le statut dans le tableau
          const row = toggleElement.closest("tr");
          const statusBadge = row.querySelector(".badge");
          statusBadge.className = "badge badge-green";
          statusBadge.textContent = "En service";

          alert(
            `${vehicleId} marqu√© comme DISPONIBLE\n\nLe mat√©riel est maintenant disponible pour les missions.`
          );
        }
      }

      // Fonctions sp√©cifiques atelier
      function startIntervention(vehicleId) {
        alert(
          `D√©marrage intervention ${vehicleId}\n\nOuverture de l'interface de suivi d√©taill√©...`
        );
      }

      function planIntervention(vehicleId) {
        alert(
          `Planification intervention ${vehicleId}\n\nOuverture du calendrier atelier...`
        );
      }

      function scheduleIntervention(vehicleId) {
        alert(
          `Programmation maintenance ${vehicleId}\n\nOuverture du calendrier de planification...`
        );
      }

      function updateIntervention(vehicleId) {
        alert(
          `Suivi intervention ${vehicleId}\n\nInterface de progression en temps r√©el...`
        );
      }

      function viewMaintenance(vehicleId) {
        alert(
          `D√©tails maintenance ${vehicleId}\n\nHistorique et planning des interventions...`
        );
      }

      function manageChrono(vehicleId) {
        alert(
          `Gestion chronotachygraphe ${vehicleId}\n\n√âtalonnage, t√©l√©chargement donn√©es, contr√¥les p√©riodiques...`
        );
      }

      function previousMonth() {
        alert("Navigation vers le mois pr√©c√©dent...");
      }

      function nextMonth() {
        alert("Navigation vers le mois suivant...");
      }

      function downloadAPK() {
        alert(
          "T√©l√©chargement de l'APK Billun Mobile...\n\nVersion pour conducteurs et techniciens avec fonctionnalit√©s de signalement."
        );
      }

      function sendDownloadLinks() {
        alert(
          "Liens de t√©l√©chargement envoy√©s par email √† tous les utilisateurs !\n\n‚úâÔ∏è Emails envoy√©s √† :\n- jean.dupont@transport-dubois.fr (Conducteur)\n- sophie.moreau@transport-dubois.fr (Chef atelier)\n- lea.mecanique@transport-dubois.fr (M√©canicienne)\n- marc.dubois@transport-dubois.fr (M√©canicien senior)\n- antoine.martin@transport-dubois.fr (M√©canicien)\n- julie.lefort@transport-dubois.fr (√âlectricienne)\n- thomas.frigoriste@transport-dubois.fr (Frigoriste)\n- Et tous les autres utilisateurs actifs"
        );
      }

      function handleLogout() {
        if (confirm("√ätes-vous s√ªr de vouloir vous d√©connecter ?")) {
          alert(
            "D√©connexion r√©ussie. Redirection vers la page de connexion..."
          );
        }
      }

      // Fermer les modals en cliquant √† l'ext√©rieur
      window.addEventListener("click", function (e) {
        const modals = document.querySelectorAll(
          ".modal, .photo-gallery-modal, .lightbox"
        );
        modals.forEach((modal) => {
          if (e.target === modal) {
            modal.classList.remove("show");
          }
        });
      });

      // Gestion du clavier pour fermer les modals
      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape") {
          document
            .querySelectorAll(
              ".modal.show, .photo-gallery-modal.show, .lightbox.show"
            )
            .forEach((modal) => {
              modal.classList.remove("show");
            });
        }
      });
    </script>
  </body>
</html>
